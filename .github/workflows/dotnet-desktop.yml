name: .NET Build EXE

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  workflow_dispatch: # Cho phép bấm nút chạy thủ công

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0

    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x' # Hoặc version bạn đang dùng (6.0, 7.0)

    # Tự động tìm file .csproj đầu tiên nếu bạn không muốn gõ tên thủ công
    - name: Restore
      run: dotnet restore $(Get-ChildItem -Recurse -Filter *.csproj | Select-Object -First 1).FullName

    - name: Build and Publish
      run: |
        $projectFile = (Get-ChildItem -Recurse -Filter *.csproj | Select-Object -First 1).FullName
        dotnet publish $projectFile `
          -c Release `
          -r win-x64 `
          --self-contained true `
          -p:PublishSingleFile=true `
          -p:PublishReadyToRun=true `
          -p:IncludeNativeLibrariesForSelfExtract=true `
          -o ./publish

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: Spoofer-EXE
        path: ./publish/*.exe
